---
import Layout from "../layouts/Layout.astro";
import { Image } from "@astrojs/image/components";
import { useSanityClient } from "astro-sanity";

type Schedule = {
  lunes: string[];
  martes: string[];
  miercoles: string[];
  jueves: string[];
  viernes: string[];
  sabado: string[];
  domingo: string[];
};

export async function getSchedule(): Promise<Schedule> {
  const query = `*[_type == "schedule"] {
  lunes,
  martes,
  miercoles,
  jueves,
  viernes,
  sabado,
  domingo
}[0]`;
  const schedule = await useSanityClient().fetch(query);

  const scheduleOrdered = {
    lunes: schedule.lunes,
    martes: schedule.martes,
    miercoles: schedule.miercoles,
    jueves: schedule.jueves,
    viernes: schedule.viernes,
    sabado: schedule.sabado,
    domingo: schedule.domingo,
  };

  return scheduleOrdered
}

const schedule = await getSchedule();
---

<Layout title="Sobre nosotros">
  <main class="w-full">
    <section
      class="max-w-md md:max-w-5xl py-8 flex flex-col gap-5 md:flex-row mx-auto px-6"
    >
      <div class="md:w-1/2 md:ml-16 rounded-lg overflow-hidden">
        <!-- <img class="w-full rounded-lg" src="/assets/test.jpg" alt="" /> -->
        <Image
          src="/assets/platillos/KetoBakeryCafe_09.jpg"
          width={500}
          height={700}
          format="webp"
          alt="Sobre nosotros"
        />
        
      </div>

      <div
        class="md:w-1/2 md:relative top-10 right-16 md:rounded-lg shadow md:bg-secondary md:p-8 md:ring-1 md:ring-slate-900/5"
      >
        <h1 class="font-semibold text-3xl text-neutral-content">
          Quiénes somos
        </h1>
        <p class="pt-3">
          Ketobakery & coffee es una cafetería que ofrece postres saludables , keto, low carb, glutenfree, y/o sin lácteos. 
        </p>
        <p class="pt-3">
          En barra de café manejamos bebidas clásicas (americano, capuccino, moka frapes) y bebidas sin azúcar, chai, matcha, tés, tizanas, frape ketl...
        </p>
      </div>
    </section>

    <section class="max-w-5xl mx-auto pb-12 px-6">
      <h2 class="text-neutral-content text-center mt-16 font-semibold text-3xl">
        Ubicación y horario
      </h2>
      <div class="flex flex-col md:flex-row gap-6 justify-center mt-6 mx-auto">
        <iframe
          src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d14934.553337310155!2d-105.2205893!3d20.6435935!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0xfc83124a922e42fa!2sKeto%20Bakery%20%26%20Coffee!5e0!3m2!1ses-419!2smx!4v1667507221181!5m2!1ses-419!2smx"
          class="rounded-lg ring-1 ring-slate-900/5 shadow mx-auto md:mx-0 w-full h-96 md:h-auto"
          style="border:0;"
          allowfullscreen=""
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"></iframe>
        <div
          class="rounded-lg ring-1 ring-slate-900/5 w-72 mx-auto md:mx-0 md:w-auto p-6 bg-base-100"
        >
          <table class="table w-full">
            <!-- head -->
            <thead>
              <tr>
                <th class="bg-base-100"></th>
                <th class="bg-base-100">Hora</th>
              </tr>
            </thead>
            <tbody class="overflow-hidden">
              <!-- map over schedule to achieve this structure in every element:
                 <tr>
                <th>Lunes</th>
                <td>
                  <span class="block">08:00 - 14:00</span>
                  <span class="block">15:00 - 21:00</span>
                </td>
              </tr> -->
              {
                Object.entries(schedule).map(([day, hours]) => {
                  // dont render if there are no hours
                  if (hours?.every((hour) => !hour)) return null;
                  return (
                    <tr>
                      <th>{day}</th>
                      <td>
                        {hours.map((hour) => {
                          if (!hour) return null;
                          return <span class="block">{hour}</span>;
                        })}
                      </td>
                    </tr>
                  );
                })
              }
              <!-- row 3 -->
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
</Layout>
