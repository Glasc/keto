---
import { useSanityClient } from "astro-sanity";
import { Categories, Category } from "./Categories";

export async function getCategories(): Promise<Category[]> {
  try {
    const query = `*[_type == "category"]{
  _id, 
  products[]->{_id, _type, price, priceSmall, priceMedium, "image":image.asset->url, priceLarge, description, title}, 
  title, 
  slug
}`;
    const listOfCategories = (await useSanityClient().fetch(
      query
    )) as Category[];

    return listOfCategories;
  } catch (err) {
    return [];
  }
}

const categories = await getCategories();
---

<Categories categories={categories} client:visible />
