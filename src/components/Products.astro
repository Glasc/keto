---
import { useSanityClient } from "astro-sanity";
import type { Category } from "../pages/products/[category].astro";
import { RiArrowDownSLine } from "react-icons/ri/index.js";
import { Categories } from "./Categories";

export async function getCategories(): Promise<Category[]> {
  try {
    const query = `*[_type == "category"]{
  _id, 
  products[]->{_id, _type, price, priceSmall, priceMedium, priceLarge, description, title}, 
  title, 
  slug
}`;
    const listOfCategories = (await useSanityClient().fetch(
      query
    )) as Category[];

    return listOfCategories;
  } catch (err) {
    return [];
  }
}

const categories = await getCategories();
---

<Categories categories={categories} client:load />
